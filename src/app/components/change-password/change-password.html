<!-- Change Password Card -->
<div class="row justify-content-center mt-4" *ngIf="!isEditing">
    <div class="col-lg-8">
      <div class="password-card card shadow-sm">
        <div class="card-header" [style.background]="'#000000'">
          <h3 class="card-title mb-0 text-white">
            <i class="fas fa-lock me-2"></i>
            {{ languageService.currentLanguage() === 'ar' ? 'إدارة كلمة المرور' : 'Password Management' }}
          </h3>
        </div>
        
        <div class="card-body p-4">
          <!-- View Mode -->
          <div *ngIf="!isChangingPassword" class="view-mode">
            <div class="row align-items-center">
              <div class="col-md-8">
                <p class="mb-0 text-muted">
                  <i class="fas fa-info-circle me-2"></i>
                  {{ languageService.currentLanguage() === 'ar' 
                     ? 'قم بتغيير كلمة المرور الخاصة بك بانتظام للحفاظ على أمان حسابك' 
                     : 'Change your password regularly to keep your account secure' }}
                </p>
              </div>
              <div class="col-md-4 text-end">
                <button class="btn btn-warning" (click)="togglePasswordChange()">
                  <i class="fas fa-key me-2"></i>
                  {{ languageService.currentLanguage() === 'ar' ? 'تغيير كلمة المرور' : 'Change Password' }}
                </button>
              </div>
            </div>
          </div>
  
          <!-- Edit Mode -->
          <form *ngIf="isChangingPassword" [formGroup]="passwordForm" (ngSubmit)="onChangePassword()" class="edit-mode">
            <div class="row">
              <!-- Current Password -->
              <div class="col-md-6 mb-3">
                <label for="currentPassword" class="form-label">
                  <i class="fas fa-lock me-1"></i>
                  {{ languageService.currentLanguage() === 'ar' ? 'كلمة المرور الحالية' : 'Current Password' }}
                  <span class="text-danger">*</span>
                </label>
                <input type="password" 
                       id="currentPassword"
                       formControlName="currentPassword"
                       class="form-control"
                       [class.is-invalid]="hasError('currentPassword', 'required', passwordForm) || hasError('currentPassword', 'minlength', passwordForm)">
                <div class="invalid-feedback" *ngIf="hasError('currentPassword', 'required', passwordForm) || hasError('currentPassword', 'minlength', passwordForm)">
                  {{ getErrorMessage('currentPassword', passwordForm) }}
                </div>
              </div>
  
              <!-- New Password -->
              <div class="col-md-6 mb-3">
                <label for="newPassword" class="form-label">
                  <i class="fas fa-key me-1"></i>
                  {{ languageService.currentLanguage() === 'ar' ? 'كلمة المرور الجديدة' : 'New Password' }}
                  <span class="text-danger">*</span>
                </label>
                <input type="password" 
                       id="newPassword"
                       formControlName="newPassword"
                       class="form-control"
                       [class.is-invalid]="hasError('newPassword', 'required', passwordForm) || hasError('newPassword', 'minlength', passwordForm)">
                <div class="invalid-feedback" *ngIf="hasError('newPassword', 'required', passwordForm) || hasError('newPassword', 'minlength', passwordForm)">
                  {{ getErrorMessage('newPassword', passwordForm) }}
                </div>
              </div>
  
              <!-- Confirm Password -->
              <div class="col-md-6 mb-3">
                <label for="confirmPassword" class="form-label">
                  <i class="fas fa-check-circle me-1"></i>
                  {{ languageService.currentLanguage() === 'ar' ? 'تأكيد كلمة المرور' : 'Confirm Password' }}
                  <span class="text-danger">*</span>
                </label>
                <input type="password" 
                       id="confirmPassword"
                       formControlName="confirmPassword"
                       class="form-control"
                       [class.is-invalid]="hasError('confirmPassword', 'required', passwordForm) || hasError('confirmPassword', 'passwordMismatch', passwordForm)">
                <div class="invalid-feedback" *ngIf="hasError('confirmPassword', 'required', passwordForm) || hasError('confirmPassword', 'passwordMismatch', passwordForm)">
                  {{ getErrorMessage('confirmPassword', passwordForm) }}
                </div>
              </div>
            </div>
  
            <!-- Action Buttons -->
            <div class="row mt-4">
              <div class="col-12">
                <div class="d-flex gap-2 flex-wrap">
                  <button type="submit" 
                          class="btn btn-warning"
                          [disabled]="passwordForm.invalid || isPasswordSubmitting">
                    <i class="fas fa-save me-2" *ngIf="!isPasswordSubmitting"></i>
                    <i class="fas fa-spinner fa-spin me-2" *ngIf="isPasswordSubmitting"></i>
                    {{ isPasswordSubmitting ? 
                       (languageService.currentLanguage() === 'ar' ? 'جاري الحفظ...' : 'Saving...') : 
                       (languageService.currentLanguage() === 'ar' ? 'تغيير كلمة المرور' : 'Change Password') }}
                  </button>
                  <button type="button" 
                          class="btn btn-outline-secondary"
                          (click)="togglePasswordChange()"
                          [disabled]="isPasswordSubmitting">
                    <i class="fas fa-times me-2"></i>
                    {{ languageService.currentLanguage() === 'ar' ? 'إلغاء' : 'Cancel' }}
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>